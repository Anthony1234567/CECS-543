<!DOCTYPE html>
<html>
  <head>
    <title>CECS 543: Version Control System</title>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css" integrity="sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ" crossorigin="anonymous">
    <script src="../js/controllerB.js"></script>
  </head>

  <body >
    <div 
      id="directory"
      class="directory">
    </div>

    <div class="dropdown">
      <button class="dropdown-button">
        Action 
        <i class="arrow down"></i>
      </button>

      <div class="dropdown-content">
        <a href="javascript:void(0)" onclick="Controller.commit()">Commit</a>
        <a href="javascript:void(0)" onclick="openModal('Check In')"">Check In</a>
        <a href="javascript:void(0)" onclick="openModal('Check Out')">Check Out</a>
      </div>
    </div>

    <!-- The Modal -->
    <div 
      id="myModal" 
      class="modal">
      <!-- Modal content -->
      <div class="modal-content">
        <span class="close">&times;</span>
        <div class="main-content">
          <input 
            type="text" 
            id="directory-field" 
            placeholder="Enter Directory"
            class="input-light"
            style="flex-grow: 1; margin-right: 1em;">
          
          <button 
            id="actionButton"
            class="button-light">
          </button>
        </div>
      </div>
    </div>

    <template>
      <div class="manifest">
        <h5 class ="label"></h5>
        <button class="fas fa-pen manifestButton" onclick="openModal('Change Label')"></i></button>
        
      </div> 
     
    </template>

    <div id="manifestList" class="manifestList">
    </div>
    
    </body>
  

  <script type="text/javascript">


  
    (function() {

      
      // Get the modal
      var modal = document.getElementById('myModal');
      // Get the <span> element that closes the modal
      var span = document.getElementsByClassName('close')[0];
      document.getElementById('directory').innerHTML = decodeURIComponent(new URL(window.location.href).searchParams.get('projectRoot'));
    
      Controller.listManifests();
      
      // When the user clicks on <span> (x), close the modal
      span.onclick = function() {
        modal.style.display = 'none';
        document.getElementById('directory-field').value = '';
      }

      // When the user clicks anywhere outside of the modal, close it
      window.onclick = function(event) {
        if (event.target == modal) {
          modal.style.display = 'none';
          document.getElementById('directory-field').value = '';
        }
      }

      
    })();

    function openModal(type, manifestId) {
      switch (type) {
        case 'Check In':
          document.getElementById('directory-field').placeholder = 'Enter Source Directory';
          document.getElementById('actionButton').innerHTML = 'Check In';
          
          // TODO: Implement call to Controller.checkIn()
          document.getElementById('actionButton').onclick = function() {
            Controller.checkIn();
            Controller.listManifests();

          }

          break;
        case 'Check Out':
          document.getElementById('directory-field').placeholder = 'Enter Target Directory';
          document.getElementById('actionButton').innerHTML = 'Check Out';

          // TODO: Implement call to Controller.checkOut()
          document.getElementById('actionButton').onclick = function() {
            Controller.checkout();
            Controller.listManifests();
          }

          break;
        case 'Change Label':
          document.getElementById('directory-field').placeholder= 'Enter New Label';
          document.getElementById('actionButton').innerHTML = 'Change Label';

          
         
          let field = "tag";
          document.getElementById('actionButton').onclick = function()
          {
            let label = document.getElementById('directory-field').value;
            document.getElementById(manifestId).innerText = label; 
            Controller.updateCommit(manifestId, field, label);        
            document.getElementById('myModal').style.display = 'none';
            document.getElementById('directory-field').value = '';
          }
          break;
        default:
          console.warn('Unknown Command.');
      }

      document.getElementById('myModal').style.display = 'block';
    }

    
    
  
  </script>
</html>
